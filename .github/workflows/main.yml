name: Deploy pygbag game
on: [push, pull_request, workflow_dispatch]
permissions: write-all
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    - uses: actions/setup-python@v5
      with: python-version: 3.11
    - run: pip install pygbag
    - run: python -m pygbag --build game.py
    - run: |
        # Copy ALL files from build/web to root
        find build/web -type f -exec cp {} . \;
        # List what we copied
        ls -la *.html *.js *.wasm || echo "No game files found"
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add .
        git commit -m "deploy pygbag game" || true
        git push
